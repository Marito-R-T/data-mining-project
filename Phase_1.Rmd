---
title: "Phase 1 - Proyect Education Formal"
output: html_notebook
---

Install haven packages

```{r}
install.packages("haven")
```
Import libraries to work

```{r}
library(arules)
library(haven)
```


Read data from .sav

```{r}
data <- read_sav("data.sav")
head(data)
data
```

Testing data

```{r}
data[data$Graduando == 2,] # Graduando 1 es que esta en el último año de su nivel, 2 es que no lo está, 9 es desconocido
data[data$Repitente == 1,] # Repitente 1 es que está repitiendo el grado, 2 es que no lo está repitiendo, 9 es desconocido
```


Find rules apriori with support 0.4 and confidence 0.5

```{r}
data <- data[,-1]
reglas <- apriori(data, parameter = list(support=0.4, confidence=0.5))
```

Inspect rule 0 to 100

```{r}
inspect(reglas[300:399]) 
# En este set en el 319 parece haber uno interesante, los extranjeros tienen una alta confidencia de no ser repitentes.
# También parece que en el 380 sugiere que de primaria a diversificado, si no es repitente no es graduando, por lo que sugiere que en los graduandos es donde # hay una mayor taza de repitencia

inspect(reglas[600:799])
# Regla 786 dice que mucho estudiante arriba de preprimaria, que no es repitente y tampoco graduando de su nivel, es del área rural

```

Level produce a lot of noise with grade into the data, so we need to filter it, in this case we filter only secondary level

```{r}
data_secundaria <- data[data$Nivel == 3,]
data_secundaria <- data_secundaria[,-8]
data_secundaria
```


Find rules apriori with support 0.3 and confidence 0.5

```{r}
reglas <- apriori(data_secundaria, parameter = list(support=0.3, confidence=0.5))
```
```{r}
inspect(reglas[0:199])
# Aquí hay cosas interesantes como la regla 16, donde menciona que hay una fuerte correlación entre ser extranjero y que su jornada sea matutina
# Aquí también se ve en la regla 32 que hay una correlación entre ser del área rural y que su jornada no sea matutina
# En la regla 45 y 36 hay una correlación entre no ser del sector publico y que el área de la persona sea urbana.
# En la regla 49 muestra que si el sector no es público hay correlación que la jornada no sea matutina.
# Regla 51 Los extranjeros no estudian en el sector público
# Regla 66 los extranjeros normalmente estan en un área urbana.


inspect(reglas[200:399])
# En la regla 300 Hay una correlación entre no ser del sector publico y ser del área urbana
```

Grado, Graduando and Repitente produce a lot of noise in rules, so I try remove it.

```{r}
data_secundaria <- data_secundaria[,-7]
data_secundaria <- data_secundaria[,-12]
data_secundaria <- data_secundaria[,-11]
data_secundaria
```

Find rules apriori with support 0.3 and confidence 0.5

```{r}
reglas <- apriori(data_secundaria, parameter = list(support=0.3, confidence=0.5))
```
```{r}
inspect(reglas[0:199])
# Regla 28 que el área sea urbana y el sector no sea publico
# Regla 30 que la jornada no sea matutina y el sector no sea público
# Regla 39 que el área sea urbana y la jornada no sea matutina
# Regla 49 que el sea extranjero y que su jornada no sea matutina


inspect(reglas[400:416])
```

# Analisis por medio de fpgrowth

Find rules about high school with support 0.3 and confidence 0.5
Remove columns who represents a lot of noise

```{r}
datafp <- data
datafp <- datafp[,-7]
datafp <- datafp[,-12]
datafp <- datafp[,-12]
datafp <- datafp[datafp$Nivel == 4,]
datafp <- datafp[,-7]
reglasfp <- fim4r(datafp, method = "fpgrowth", target = "rules", support = .3, confidence = .5)
```
```{r}
datafp
datafp[datafp$Pueblo_Per == 9,]
```

View Rules

```{r}
reglasfpframe <- as(reglasfp, "data.frame")
View(reglasfpframe)
# Regla 126, alta confianza en que los extranjeros estudian en horarios no matutinos
# Regla 191 Si el sector no es público la jornada es más probable que no sea matutina.
```


Remove All undefined data

```{r}
datafp <- datafp[datafp$Sexo != 9,]
datafp <- datafp[datafp$Sector != 9,]
datafp <- datafp[datafp$Área != 9,]
datafp <- datafp[datafp$Pueblo_Per != 9,]
datafp <- datafp[datafp$Plan_Est != 9,]
datafp <- datafp[datafp$Jornada_Est != 9,]
datafp <- datafp[datafp$Resultado_F != 9,]
reglasfp <- fim4r(datafp, method = "fpgrowth", target = "rules", support = .3, confidence = .5)
```
View Data

```{r}
reglasfpframe <- as(reglasfp, "data.frame")
View(reglasfpframe)
# Regla 446 Los alumnos de los departamentos de Guatemala, El progreso, Sacatepéquez, Chimaltenango, Escuintla, Santa Rosa, Sololá, Toto, Quetgo son departamentos los cuales es más probable que no pertenezcan al sector público.
# Regla 190 Los sectores que no son públicos son mayoritariamente de alumnos pertenecientes a la población extranjera.
# Regla 703 El sector no publico tiene más probabilidad de tener una jornada no matutina
# Analizando data se puede ver que el glosario entregado esta incorrecto, el pueblo de pertenencia 5, el cuál dice que es extranjero, en realidad es Mestizo/Ladino, el 6 es otro, Maya es 1, Garifuna 2, Xinca 3, Extranjero 4 (parece aunque no hay data), Por lo que todo las reglas anteriores que diga Extranjero es Mestizo/Ladino y otro.
# Regla 976 aunque ya cerca del .3 de soporte, se encuentra que si la jornada es matutina, es más probable que pertenezca al pueblo ladino, aunque en la regla 558 se muestra que el pueblo es ladino también si la jornada no es matutina, se tiene un problema de información mayoritaria para el los ladinos.
```

